<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Card Slot Clicker - マナ＋手札機能付き</title>
<style>
  :root{
    --bg:#f7f7fb;
    --panel:#ffffff;
    --muted:#777;
    --accent:#f76b6b;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);font-family:Inter, system-ui, -apple-system, "Helvetica Neue", Arial;color:#111;display:flex;justify-content:center;padding:10px;height:100vh;overflow:hidden}
  .container{width:1200px;max-width:100%;height:100%;display:flex;gap:10px}
  .left{flex:1;background:var(--panel);border-radius:12px;padding:10px;box-shadow:0 6px 18px rgba(20,20,40,0.06);display:flex;flex-direction:column;justify-content:flex-start;overflow:hidden}
  .xpbar{height:14px;background:#eee;border-radius:8px;overflow:hidden;margin-bottom:6px}
  .xpfill{height:100%;width:0%;background:#6cf;transition:width 300ms}
  .leveltxt{font-size:12px;margin-bottom:6px;color:var(--muted)}
  .slot-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;width:100%;flex:1}
  .cell{aspect-ratio:8/5;border:3px solid #ccc;border-radius:8px;background:#fff;display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative}
  .cell img{width:100%;height:100%;object-fit:contain;pointer-events:none}
  .controls{display:flex;align-items:center;gap:8px;margin-top:8px;flex-wrap:wrap}
  button{cursor:pointer;border:0;background:#222;color:#fff;padding:6px 10px;border-radius:8px;font-size:13px}
  #spinBtn{background:var(--accent);font-weight:700;padding:8px 14px}
  .stop-row{display:flex;gap:6px}
  .stopBtn{background:#ffcf52;color:#111;padding:6px 10px;border-radius:8px;font-size:12px}
  .status{display:flex;gap:12px;align-items:center;margin-top:6px;font-size:13px}
  .hand{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px;padding:6px;border-radius:8px;background:#fff;border:2px solid #ffdede;max-height:80px;overflow-y:auto}
  .card{width:60px;aspect-ratio:5/8;border-radius:6px;border:2px solid #ddd;background:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer}
  .card img{width:100%;height:100%;object-fit:contain}
  .small{font-size:12px;color:#444}
  .right{width:380px;display:flex;flex-direction:column;gap:8px;overflow:hidden}
  .panel{background:var(--panel);padding:10px;border-radius:12px;box-shadow:0 6px 18px rgba(20,20,40,0.06)}
  .clicker-center{display:flex;flex-direction:column;align-items:center;gap:6px}
  #clickBtn{width:180px;height:180px;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;border:5px solid #ff9ab0;background:#ffeef3;cursor:pointer;transition:transform .08s}
  #clickBtn img{width:90%;height:90%;object-fit:contain;border-radius:50%}
  #clickBtn:active{transform:scale(.93)}
  .upgrades{display:flex;gap:6px;flex-wrap:wrap;justify-content:center;margin-top:4px}
  .upgradeBtn{background:#5aa0ff;color:#fff;padding:6px 10px;border-radius:8px;border:0;cursor:pointer;font-size:12px}
  .skills-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px}
  .skill-btn{background:#cfe8ff;border-radius:8px;padding:8px;border:1px solid #b6dbff;cursor:pointer;display:flex;flex-direction:column;align-items:flex-start;gap:4px;font-size:12px}
  .skill-line{display:flex;justify-content:space-between;width:100%}
  .skill-meta{font-size:11px;color:#444}
  .toast{position:fixed;right:14px;top:14px;background:#111;color:#fff;padding:8px 12px;border-radius:8px;opacity:0.98;box-shadow:0 8px 30px rgba(0,0,0,0.25);font-size:13px}
  @media(max-width:1100px){.container{flex-direction:column;width:100%}.right{width:100%}}
</style>
</head>
<body>
<div class="container">
  <div class="left panel" id="leftPanel">
    <div class="xpbar"><div id="xpFill" class="xpfill"></div></div>
    <div class="leveltxt">Lv <span id="level">1</span> • XP <span id="xp">0</span>/<span id="xpNeed">5</span></div>

    <div class="slot-grid" id="slotGrid"></div>

    <div class="controls">
      <div class="stop-row">
        <button class="stopBtn" id="stop0" disabled>左リール停止</button>
        <button class="stopBtn" id="stop1" disabled>中リール停止</button>
        <button class="stopBtn" id="stop2" disabled>右リール停止</button>
      </div>
      <div style="display:flex;align-items:center;gap:6px;">
        <button id="spinBtn">スピン ( -20 )</button>
        <div class="small">固定ベット: 20</div>
      </div>
    </div>

    <div class="status">
      <div>コイン: <strong id="coin">100</strong></div>
      <div>マナ: <strong id="mana">0</strong></div>
      <div>ラック: <strong id="luckView">50</strong></div>
    </div>

    <div class="small" style="margin-top:6px">手札（クリックで使用）：</div>
    <div class="hand" id="hand"></div>
  </div>

  <div class="right">
    <div class="panel clicker">
      <div class="clicker-center">
        <div id="clickBtn"><img id="clickImg" src="images/click1.png" alt="click"></div>
        <div class="upgrades">
          <button id="upgradeClick" class="upgradeBtn">クリック+ (必要マナ: <span id="cost_click">2</span>)</button>
          <button id="upgradeAuto" class="upgradeBtn">自動+1/s (必要マナ: <span id="cost_auto">3</span>)</button>
        </div>
      </div>
      <div class="small" style="margin-top:6px">クリックPower: <span id="clickPower">1</span> • 自動Power: <span id="autoPower">0</span></div>
    </div>

    <div class="panel skills">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
        <strong>スキルツリー (ボタン式)</strong>
        <div class="small">スキルP: <span id="skillPoint">0</span></div>
      </div>
      <div class="skills-grid" id="skillsGrid"></div>
    </div>
  </div>
</div>

<div id="toastHolder" style="position:fixed;right:14px;top:14px;z-index:1200"></div>

<script>
const $ = id => document.getElementById(id);
const randInt = n => Math.floor(Math.random()*n);

const IMAGES = {
  slots: Array.from({length:9},(_,i)=>`images/slot${i+1}.png`),
  cards: Array.from({length:7},(_,i)=>`images/card${i+1}.png`),
  clicks: [`images/click1.png`]
};

let spinning = [false,false,false];
let intervalIds = [null,null,null];
let coins = 100;
let mana = 0;

function setup(){
  const grid = $('slotGrid');
  grid.innerHTML = '';
  for(let i=0;i<9;i++){
    const cell = document.createElement('div');
    cell.className = 'cell';
    const img = document.createElement('img');
    img.src = IMAGES.slots[randInt(IMAGES.slots.length)];
    cell.appendChild(img);
    grid.appendChild(cell);
  }
}

function startSpin(){
  if(coins < 20) return alert('コイン不足！');
  coins -= 20;
  $('coin').textContent = coins;
  for(let i=0;i<3;i++){
    spinning[i] = true;
    $('stop'+i).disabled = false;
    const col = document.querySelectorAll('.cell:nth-child(3n+'+(i+1)+') img');
    intervalIds[i] = setInterval(()=>{
      col.forEach(img=>img.src = IMAGES.slots[randInt(IMAGES.slots.length)]);
    },100);
  }
}

function stopReel(index){
  spinning[index] = false;
  clearInterval(intervalIds[index]);
  $('stop'+index).disabled = true;
  if(spinning.every(s=>!s)){
    checkResult();
    endTurn(); // ← ターン終了処理
  }
}

function checkResult(){
  const imgs = Array.from(document.querySelectorAll('.cell img'));
  const middle = [imgs[3].src, imgs[4].src, imgs[5].src];
  if(middle[0]===middle[1] && middle[1]===middle[2]){
    coins += 100;
    $('coin').textContent = coins;
    showToast('🎉 あたり！ +100 コイン');
  }
}

// === ここから追加 ===
function endTurn(){
  // マナ +1
  mana++;
  $('mana').textContent = mana;

  // 手札 +1
  const hand = $('hand');
  const card = document.createElement('div');
  card.className = 'card';
  const img = document.createElement('img');
  img.src = IMAGES.cards[randInt(IMAGES.cards.length)];
  card.appendChild(img);
  hand.appendChild(card);

  showToast('✨ ターン終了：マナ+1／手札+1');
}
// === ここまで追加 ===

function showToast(msg){
  const div = document.createElement('div');
  div.className = 'toast';
  div.textContent = msg;
  $('toastHolder').appendChild(div);
  setTimeout(()=>div.remove(),2000);
}

$('spinBtn').addEventListener('click', startSpin);
$('stop0').addEventListener('click', ()=>stopReel(0));
$('stop1').addEventListener('click', ()=>stopReel(1));
$('stop2').addEventListener('click', ()=>stopReel(2));

$('clickBtn').addEventListener('click', ()=>{
  $('clickImg').src = IMAGES.clicks[0];
  coins += 1;
  $('coin').textContent = coins;
});

setup();
</script>
</body>
</html>
