<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Card Slot Clicker 1to9</title>
<style>
body{
  margin:0; padding:0; background:#222; color:#fff;
  font-family:sans-serif;
  display:flex; justify-content:center; align-items:flex-start;
  min-height:100vh;
}
.wrap{
  display:grid;
  grid-template-columns:1fr 1fr;
  width:100%;
  max-width:1400px;
  transform:scale(0.9);
  transform-origin:top center;
  gap:8px;
}

/* XPバー */
#xpBar{
  width:100%; height:20px; background:#555; border-radius:8px;
  overflow:hidden; margin-bottom:8px;
}
#xpFill{
  height:100%; background:linear-gradient(90deg,#6f6,#0f0);
  width:0%;
}

/* スロットエリア */
.slot-area{
  display:grid; grid-template-columns:repeat(3,1fr);
  gap:6px; width:100%;
}
.cell{
  aspect-ratio:8/5; border:2px solid #444; border-radius:6px;
  display:flex; align-items:center; justify-content:center;
  background:#111; overflow:hidden;
}
.cell img{ width:100%; height:100%; object-fit:contain; }

.stop-buttons{ display:flex; justify-content:center; gap:20px; margin:10px; }
.stopBtn{
  padding:6px 12px; font-size:0.9rem;
  border:none; border-radius:6px;
  background:#ffcc00; color:#000; cursor:pointer;
}
.stopBtn:disabled{ background:#555; cursor:not-allowed; }

/* ステータス */
.status{
  display:flex; gap:20px; justify-content:center; align-items:center;
  font-size:1.1rem; margin-top:8px;
}

/* 手札 */
.hand{ display:flex; justify-content:center; gap:8px; flex-wrap:wrap;
  width:100%; border:3px solid #c33; padding:8px; border-radius:8px; }
.card{ aspect-ratio:5/8; width:72px; background:#333; border:2px solid #666; border-radius:6px;
  display:flex; align-items:center; justify-content:center; cursor:pointer; }
.card img{ width:100%; height:100%; object-fit:contain; }

/* スピンボタン */
#spinBtn{
  margin:12px; padding:10px 22px; font-size:1.2rem; cursor:pointer;
  border:none; border-radius:12px; background:#f33; color:#fff; font-weight:bold;
  box-shadow:0 4px 8px rgba(0,0,0,0.6); transition:transform 0.1s;
}
#spinBtn:active{ transform:scale(0.95); }
#spinBtn:disabled{ opacity:0.6; cursor:not-allowed; }

/* クリックゲーム */
.clicker{
  display:flex; flex-direction:column; align-items:center;
  border:3px solid #39f; border-radius:8px; padding:12px;
}
#clickBtn{
  width:160px; height:160px; border-radius:50%;
  background:url('images/click1.png') center/cover no-repeat;
  border:none; cursor:pointer; transition:transform 0.1s;
}
#clickBtn:active{ transform:scale(0.9); }

/* 強化UI */
.upgrades button{
  margin:6px; padding:6px 12px; border:none; border-radius:6px;
  background:#08f; color:#fff; cursor:pointer;
}

/* スキルツリー */
.skill-tree{
  border:3px solid #9cf; margin-top:12px; padding:8px; border-radius:8px;
}
.skill-tree button{
  display:block; width:100%; margin:4px 0; padding:6px;
  background:#6af; border:none; border-radius:6px; cursor:pointer;
}
</style>
</head>
<body>
<div class="wrap">
  <div>
    <!-- XP UI -->
    <div id="xpUI">
      Lv: <span id="level">1</span>
      <div id="xpBar"><div id="xpFill"></div></div>
      XP: <span id="xp">0</span>/<span id="nextXp">5</span>
    </div>

    <!-- スロットセル -->
    <div class="slot-area">
      <div class="cell" id="cell0"></div>
      <div class="cell" id="cell1"></div>
      <div class="cell" id="cell2"></div>
      <div class="cell" id="cell3"></div>
      <div class="cell" id="cell4"></div>
      <div class="cell" id="cell5"></div>
      <div class="cell" id="cell6"></div>
      <div class="cell" id="cell7"></div>
      <div class="cell" id="cell8"></div>
    </div>

    <!-- 停止ボタン -->
    <div class="stop-buttons">
      <button class="stopBtn" id="stop0" disabled>左リール停止</button>
      <button class="stopBtn" id="stop1" disabled>中リール停止</button>
      <button class="stopBtn" id="stop2" disabled>右リール停止</button>
    </div>

    <div>
      <button id="spinBtn">スピン (-20)</button>
    </div>

    <!-- ステータス -->
    <div class="status">
      <div>コイン: <span id="coin">100</span></div>
      <div>マナ: <span id="mana">0</span></div>
    </div>

    <!-- 手札 -->
    <div class="hand" id="hand"></div>
  </div>

  <!-- 右側：クリッカー＆スキル -->
  <div class="clicker">
    <button id="clickBtn"></button>
    <div class="upgrades">
      <button id="upgradeClick">クリック強化 Lv<span id="clickLv">1</span> (コスト:<span id="clickCost">2</span>マナ)</button>
      <button id="upgradeAuto">自動クリック Lv<span id="autoLv">0</span> (コスト:<span id="autoCost">3</span>マナ)</button>
    </div>
    <div class="skill-tree">
      <h3>スキルツリー</h3>
      <button id="skill1">スロット補正 Lv<span id="slotSkill">0</span></button>
      <button id="skill2">マナ効率 Lv<span id="manaSkill">0</span></button>
      <button id="skill3">クリックボーナス Lv<span id="clickSkill">0</span></button>
    </div>
  </div>
</div>

<script>
let coin=100, mana=0, xp=0, level=1;
let clickLv=1, autoLv=0;
let slotSkill=0, manaSkill=0, clickSkill=0;
let hand=[], deck=[], discard=[];
let spinning=[false,false,false], spinIntervals=[null,null,null];

const symbols=[
  "images/slot1.png","images/slot2.png","images/slot3.png",
  "images/slot4.png","images/slot5.png","images/slot6.png",
  "images/slot7.png","images/slot8.png","images/slot9.png"
];

const cardTypes=[
  {img:"images/card1.png", type:"reroll", cost:2},
  {img:"images/card2.png", type:"double", cost:2},
  {img:"images/card3.png", type:"draw", cost:1},
  {img:"images/card4.png", type:"insurance", cost:2},
  {img:"images/card5.png", type:"superspin", cost:3},
  {img:"images/card6.png", type:"manarecover", cost:1},
  {img:"images/card7.png", type:"coinplus", cost:1}
];

function initDeck(){ deck=[]; for(let i=0;i<3;i++) deck=deck.concat(cardTypes); shuffle(deck); }
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }
function drawCard(){ if(hand.length>=7)return; if(deck.length===0){ deck=discard; discard=[]; shuffle(deck);} if(deck.length>0){ let c=deck.pop(); hand.push(c); renderHand(); }}
function renderHand(){ let h=document.getElementById("hand"); h.innerHTML=""; hand.forEach((card,i)=>{ let c=document.createElement("div"); c.className="card"; let img=document.createElement("img"); img.src=card.img; c.appendChild(img); c.onclick=()=>playCard(i); h.appendChild(c); }); }

function playCard(i){ let card=hand[i]; if(mana<card.cost)return; mana-=card.cost; discard.push(card); hand.splice(i,1); renderHand(); applyEffect(card); updateUI(); }

function applyEffect(card){
  switch(card.type){
    case "coinplus": coin+=20; break;
    case "manarecover": mana+=2; break;
    case "double": doubleNextWin=true; break;
    case "draw": drawCard(); break;
    case "insurance": insuranceActive=true; break;
    case "superspin": superspinActive=true; break;
    case "reroll": rerollActive=true; break;
  }
  updateUI();
}

let doubleNextWin=false, insuranceActive=false, superspinActive=false, rerollActive=false;

function spin(){
  if(coin<20 && !insuranceActive){ alert("コイン不足！"); return; }
  if(!insuranceActive){ coin-=20; }
  insuranceActive=false;
  updateUI();
  document.getElementById("spinBtn").disabled=true;

  for(let r=0;r<3;r++){
    spinning[r]=true;
    document.getElementById("stop"+r).disabled=false;
    let cells=[document.getElementById("cell"+r),document.getElementById("cell"+(r+3)),document.getElementById("cell"+(r+6))];
    spinIntervals[r]=setInterval(()=>{
      cells.forEach(cell=>{ let img=document.createElement("img"); img.src=symbols[Math.floor(Math.random()*symbols.length)]; cell.innerHTML=""; cell.appendChild(img); });
    },100);
  }
}

function stopReel(r){
  if(!spinning[r])return;
  clearInterval(spinIntervals[r]); spinIntervals[r]=null; spinning[r]=false;
  document.getElementById("stop"+r).disabled=true;
  if(!spinning[0]&&!spinning[1]&&!spinning[2]){ checkWin(); endTurn(); }
}

function checkWin(){
  let bet=20; let reward=0;
  let cells=[]; for(let i=0;i<9;i++) cells.push(document.getElementById("cell"+i).firstChild.src);
  let lines=[ [0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6] ];
  lines.forEach(line=>{
    if(cells[line[0]]===cells[line[1]]&&cells[line[1]]===cells[line[2]]){
      let add=bet*5;
      if(doubleNextWin){ add*=2; doubleNextWin=false; }
      reward+=add;
    }
  });
  if(reward>0){ coin+=reward; xp+=2; }
  updateUI();
}

function endTurn(){ mana++; drawCard(); levelUpCheck(); document.getElementById("spinBtn").disabled=false; saveGame(); }

function levelUpCheck(){ let need=level*5; if(xp>=need){ xp-=need; level++; coin+=10; mana+=2; } }

function updateUI(){
  document.getElementById("coin").textContent=coin;
  document.getElementById("mana").textContent=mana;
  document.getElementById("xp").textContent=xp;
  document.getElementById("level").textContent=level;
  document.getElementById("nextXp").textContent=level*5;
  document.getElementById("xpFill").style.width=(xp/(level*5))*100+"%";
  document.getElementById("clickLv").textContent=clickLv;
  document.getElementById("autoLv").textContent=autoLv;
  document.getElementById("slotSkill").textContent=slotSkill;
  document.getElementById("manaSkill").textContent=manaSkill;
  document.getElementById("clickSkill").textContent=clickSkill;
}

// クリック処理
let autoInterval=setInterval(()=>{ coin+=autoLv; updateUI(); },1000);

document.getElementById("clickBtn").onclick=()=>{ coin+=clickLv; updateUI(); };

// 強化
function upgradeClick(){ let cost=2+(clickLv-1); if(mana>=cost){ mana-=cost; clickLv++; updateUI(); }}
function upgradeAuto(){ let cost=3+(autoLv); if(mana>=cost){ mana-=cost; autoLv++; updateUI(); }}

document.getElementById("upgradeClick").onclick=upgradeClick;
document.getElementById("upgradeAuto").onclick=upgradeAuto;

// スキルツリー
function skill1(){ if(mana>=5){ mana-=5; slotSkill++; updateUI(); }}
function skill2(){ if(mana>=5){ mana-=5; manaSkill++; updateUI(); }}
function skill3(){ if(mana>=5){ mana-=5; clickSkill++; updateUI(); }}

document.getElementById("skill1").onclick=skill1;
document.getElementById("skill2").onclick=skill2;
document.getElementById("skill3").onclick=skill3;

// セーブ・ロード
function saveGame(){ let data={coin,mana,xp,level,clickLv,autoLv,slotSkill,manaSkill,clickSkill}; localStorage.setItem("gameSave",JSON.stringify(data)); }
function loadGame(){ let data=JSON.parse(localStorage.getItem("gameSave")); if(data){ Object.assign(window,data); updateUI(); }}

// 初期化
initDeck(); drawCard(); updateUI(); loadGame();

document.getElementById("spinBtn").onclick=()=>spin();
document.getElementById("stop0").onclick=()=>stopReel(0);
document.getElementById("stop1").onclick=()=>stopReel(1);
document.getElementById("stop2").onclick=()=>stopReel(2);
</script>
</body>
</html>
